<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerala Heritage Hub</title>

    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(90deg, #006400, #f4a3004f, #ffeb99);
        }

        .firstnav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 20px;
            background-color: transparent; 
            top: 0;
            z-index: 999;
        }
        .firstnav .logo {
            font-weight: bold;
            font-size: 20px;
            color: white;
        }

        /* User buttons and cart */
        .firstnav .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        #login-btn,
        #checkout-btn {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        #login-btn:hover,
        #checkout-btn:hover {
            background-color: #a0522d;
        }
        .firstnav .cart {
            cursor: pointer;
            background: none; 
            color: brown; 
            padding: 5px 10px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            transition: background-color 0.2s;
        }
        .firstnav .cart:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

      
        .bottom-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(90deg, #00640077, #f4a3004f, #ffeb99);
            color:white;
            padding: 10px 0;
            gap: 30px;
            position:sticky;
            top: 0px;
            z-index: 99;
        }
        .bottom-nav a {
            color: white;
            text-decoration: none;
            font-weight: 800;
            cursor: pointer;
        }
        .bottom-nav a:hover {
            text-decoration: underline;
        }

        
        .container {
            display: flex;
            gap: 10px;
            margin: 0 auto;
            padding: 0px;
        }
        .leftpanel {
            flex: 1;
            width: 200px;
            padding: 15px;
            background: linear-gradient(90deg, #006400, #f4a3004f, #ffeb99);
            box-shadow: 0 0 100px rgba(222, 184, 135, 0.596);
            position: sticky;
            top: 0px;
            height: 100vh;
            color: white;
        }
        .leftpanel ul {
            list-style: none;
            padding: 0;
        }
        .leftpanel li {
            padding: 10px 0;
            cursor: pointer;
            font-weight: bold;
        }

        .rightpanel {
            flex: 4;
            background: white;
            box-shadow: 0 0 100px rgba(255, 255, 255, 0.493);
            padding: 15px;
            min-height: 100vh;
            margin-top: 0;
        }

      
        .gallery {
            display: none;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 20px;
        }
        .gallery.active {
            display: flex;
        }

 
        .product-card {
            width: 280px;
            max-width: calc(33.33% - 20px);
            background: #c7d8b6;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .product-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }
        .product-info {
            padding: 15px;
            text-align: center;
        }
        .product-info h4 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            color: #333;
        }
        .product-info p {
            margin: 0 0 10px 0;
            font-size: 1.3em;
            font-weight: bold;
            color: #4caf50;
        }
        .add-to-cart-btn {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        .add-to-cart-btn:hover {
            background: linear-gradient(90deg, #006400, #f4a3004f, #ffeb99);
        }

        #login-modal, #cart-modal {
            display:none; 
            position:fixed; 
            top:0; left:0; width:100%; height:100%; 
            background:rgba(0,0,0,0.8); 
            z-index:1000; 
            justify-content:center; 
            align-items:center;
        }

        #login-modal > div, #cart-modal > div {
            background:white; 
            padding:30px; 
            border-radius:10px; 
            text-align:center;
        }

       
        @media (max-width: 768px) {
            .container { flex-direction: column;
             }
            .leftpanel,
             .rightpanel { 
                width: 100%; 
                position: relative; 
                height: auto;
             }
            .product-card {
                 width: 45%;
                  max-width: 100%; 
            }
            .bottom-nav { 
                flex-wrap: Wrap;
                 gap: 15px;
             }
        }
    </style>
</head>

<body>
   
    <div class="firstnav">
        <div class="logo"><a style="text-decoration: none;"  href="index.html"> <H3 style="color: white;"> <i>THE KERALA HERITAGE HUB</i> </H3> </a></div>
        <div class="user-controls">
            <button id="login-btn">Login</button>
            <div class="cart" id="howmanycart">ðŸ›’ Cart: <span id="cartcount">0</span></div>
            <button id="checkout-btn">Proceed to Buy</button> 
        </div>
    </div>


    <div class="bottom-nav">
        <a onclick="showGallery('mens')">Mens</a>
        <a onclick="showGallery('womans')">Womans</a>
        <a onclick="showGallery('antique')">Antique Gallery</a>
        <a onclick="showGallery('crafts')">Handmade Crafts</a>
    </div>

    <!-- <div class="container">
        <div class="leftpanel">
            <ul>
                <li>Category</li>
                <li>Price</li>
                <li>Filter</li>
            </ul> -----
        </div> -->

        <div class="rightpanel">
            <div class="gallery active" id="mens"></div>
            <div class="gallery" id="womans"></div>
            <div class="gallery" id="antique"></div>
            <div class="gallery" id="crafts"></div>
        </div>
    </div> 

  
   <!-- Login Modal -->
<div id="login-modal" class="modal">
  <div class="modal-content">
    <span class="close modal-close">&times;</span>
    <h3 style="text-align:center;">Customer Login</h3>
    <form id="login-form">
      <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Enter username" required>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Enter email" required>
      </div>

      <div class="form-group">
        <label for="phone">Phone No.:</label>
        <input type="tel" id="phone" placeholder="Enter phone number" required>
      </div>

      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Enter password" required>
      </div>

      <div class="form-group">
        <label for="confirm-password">Confirm Password:</label>
        <input type="password" id="confirm-password" placeholder="Re-enter password" required>
      </div>

      <div id="login-errors"></div>

      <button type="submit" id="login-submit-btn">Login</button>
    </form>
  </div>
</div>

  
    <div id="cart-modal">
        <div style="width:400px; max-width:90%;">
            <h3>Your Shopping Cart ðŸ›’</h3>
            <div id="cart-list" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;"></div>
            <div style="font-weight:bold; margin-bottom:20px;">Total Items: <span id="cart-total-items">0</span></div>
            <button onclick="document.getElementById('cart-modal').style.display='none'">Continue Shopping</button>
            <button onclick="proceedToBuy()" style="background:#8b4513; color:white;">Proceed to Buy</button>
        </div>
    </div>

   
    <script>
// --- Constants & state ---
let allProducts = [];
let cart = [];
let isLoggedIn = false; // intentionally NOT persisted across refresh
const CART_STORAGE_KEY = 'myShoppingSiteCart';
const PRODUCTS_STORAGE_KEY = 'myShoppingSiteProducts';

// --- Load products and initial setup ---
async function loadProductData() {
  try {
    const response = await fetch('product.json');
    allProducts = await response.json();
    localStorage.setItem(PRODUCTS_STORAGE_KEY, JSON.stringify(allProducts));
    loadCartFromStorage();
    showGallery('mens');
    attachGlobalListeners();
    updateCartCount();
    // Attach login form handler if login form exists
    document.getElementById('login-form')?.addEventListener('submit', handleLoginForm);
  } catch (error) {
    console.error("Error loading product.json:", error);
    const mensEl = document.getElementById('mens');
    if (mensEl) mensEl.innerHTML = "<p style='color:red;'>Error loading products.</p>";
  }
}

// --- Product card builder ---
function createProductCardHTML(product) {
  return `
    <div class="product-card" data-id="${product.id}">
      <img src="${product.image_url}" alt="${product.name}">
      <div class="product-info">
        <h4>${product.name}</h4>
        <p>â‚¹${Number(product.price).toFixed(0)}</p>
        <button class="add-to-cart-btn" data-product-id="${product.id}">Add to Cart</button>
      </div>
    </div>
  `;
}

// --- Show gallery for category ---
function showGallery(categoryId) {
  document.querySelectorAll('.gallery').forEach(g => {
    g.classList.remove('active');
    g.innerHTML = '';
  });

  const targetGallery = document.getElementById(categoryId);
  if (!targetGallery) return;

  const productsToDisplay = allProducts.filter(p => p.category_id === categoryId);
  let productsHTML = '';
  productsToDisplay.forEach(product => {
    productsHTML += createProductCardHTML(product);
  });

  targetGallery.innerHTML = productsHTML;
  targetGallery.classList.add('active');

  attachAddToCartListeners();
}

// --- Cart persistence ---
function saveCartToStorage() {
  localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
}
function loadCartFromStorage() {
  const storedCart = localStorage.getItem(CART_STORAGE_KEY);
  cart = storedCart ? JSON.parse(storedCart) : [];
}

// --- UI updates ---
function updateCartCount() {
  const countEls = document.querySelectorAll('#cartcount, #cart-total-items');
  countEls.forEach(el => { if (el) el.textContent = cart.length; });
}

// --- Add to cart handler (requires login) ---
function addToCart(event) {
  const productId = event.currentTarget.getAttribute('data-product-id');
  if (!productId) return;

  if (!isLoggedIn) {
    // Show login modal first; store attempted action so we can resume
    showLoginModal(() => {
      // resume adding after successful login
      cart.push(productId);
      saveCartToStorage();
      updateCartCount();
      flashAddedButton(event.currentTarget);
    });
    return;
  }

  // Logged in: proceed to add
  cart.push(productId);
  saveCartToStorage();
  updateCartCount();
  flashAddedButton(event.currentTarget);
}

function flashAddedButton(btn) {
  const orig = btn.textContent;
  btn.textContent = 'Added!';
  btn.disabled = true;
  setTimeout(() => { btn.textContent = orig; btn.disabled = false; }, 800);
}

// --- Show cart modal ---
function showCartModal() {
  if (cart.length === 0) {
    alert("Your cart is empty!");
    return;
  }

  const cartList = document.getElementById('cart-list');
  const productCounts = {};
  cart.forEach(id => productCounts[id] = (productCounts[id] || 0) + 1);

  let listHTML = '<ul style="list-style:none;padding:0;margin:0;">';
  for (const id in productCounts) {
    const product = allProducts.find(p => String(p.id) === String(id));
    if (product) {
      listHTML += `<li style="margin-bottom:8px;">${product.name} (x${productCounts[id]}) - â‚¹${(product.price * productCounts[id]).toFixed(0)}</li>`;
    }
  }
  listHTML += '</ul>';
  if (cartList) cartList.innerHTML = listHTML;

  document.getElementById('cart-total-items').textContent = cart.length;
  document.getElementById('cart-modal').style.display = 'flex';
}

// --- Login modal & form handling ---
// showLoginModal optionally accepts a callback to run AFTER a successful login (resume action)
function showLoginModal(afterLoginCallback) {
  const modal = document.getElementById('login-modal');
  if (!modal) return;
  modal.style.display = 'flex';

  // store the callback for after successful login
  modal._afterLoginCallback = typeof afterLoginCallback === 'function' ? afterLoginCallback : null;
}

// Validate login/register fields
function validateRegistrationFields({ username, email, phone, password, confirmPassword }) {
  const errors = [];

  if (!username || username.trim().length < 2) errors.push("Enter a valid username (min 2 chars).");

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || !emailRegex.test(email)) errors.push("Enter a valid email address.");

  const phoneDigits = phone ? phone.replace(/\D/g, '') : '';
  if (!phone || phoneDigits.length < 7 || phoneDigits.length > 15) errors.push("Enter a valid phone number (7-15 digits).");

  if (!password || password.length < 6) errors.push("Password must be at least 6 characters.");
  if (password !== confirmPassword) errors.push("Password and Confirm Password do not match.");

  return errors;
}

// Handle login form submit (we treat it as register+login for simplicity)
function handleLoginForm(event) {
  event.preventDefault();
  const username = document.getElementById('username')?.value ?? '';
  const email = document.getElementById('email')?.value ?? '';
  const phone = document.getElementById('phone')?.value ?? '';
  const password = document.getElementById('password')?.value ?? '';
  const confirmPassword = document.getElementById('confirm-password')?.value ?? '';

  const errors = validateRegistrationFields({ username, email, phone, password, confirmPassword });

  const errorContainer = document.getElementById('login-errors');
  if (errorContainer) errorContainer.innerHTML = '';

  if (errors.length) {
    if (errorContainer) {
      errorContainer.innerHTML = '<ul style="color:red;margin:0;padding-left:18px;">' + errors.map(e => `<li>${e}</li>`).join('') + '</ul>';
    } else {
      alert(errors.join('\n'));
    }
    return;
  }

  // Simulate a successful login. DO NOT persist isLoggedIn across refresh by design.
  isLoggedIn = true;
  const loginBtn = document.getElementById('login-btn');
  if (loginBtn) loginBtn.textContent = 'Logout';

  // hide modal
  const modal = document.getElementById('login-modal');
  if (modal) modal.style.display = 'none';

  // run any callback set when the modal was shown (e.g., resume add-to-cart)
  if (modal && typeof modal._afterLoginCallback === 'function') {
    const cb = modal._afterLoginCallback;
    modal._afterLoginCallback = null;
    cb();
  }
}

// --- Proceed to buy / checkout ---
function proceedToBuy() {
  if (cart.length === 0) { alert("Cart is empty!"); return; }

  if (!isLoggedIn) {
    // ask user to login first, then continue to checkout when they login
    document.getElementById('cart-modal').style.display = 'none';
    showLoginModal(() => {
      // after login, navigate to checkout
      saveCartToStorage();
      window.location.href = "checkout.html";
    });
    return;
  }

  // logged in -> save cart and go to checkout
  saveCartToStorage();
  window.location.href = "checkout.html";
}

// --- Attach add-to-cart listeners (safe rebind) ---
function attachAddToCartListeners() {
  document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
    btn.removeEventListener('click', addToCart); // safe remove
    btn.addEventListener('click', addToCart);
  });
}

// --- Global listeners for buttons on page ---
function attachGlobalListeners() {
  document.getElementById('checkout-btn')?.addEventListener('click', () => {
    // Toggle: if cart modal closed -> open it, else try to proceed to buy
    const cartModal = document.getElementById('cart-modal');
    if (!cartModal || cartModal.style.display !== 'flex') {
      showCartModal();
    } else {
      proceedToBuy();
    }
  });

  document.getElementById('howmanycart')?.addEventListener('click', showCartModal);

  document.getElementById('login-btn')?.addEventListener('click', () => {
    if (isLoggedIn) {
      toggleLoginStatus();
    } else {
      showLoginModal();
    }
  });

  // close cart modal when clicking outside or on a close icon (if present)
  document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', () => {
    const parent = btn.closest('.modal');
    if (parent) parent.style.display = 'none';
  }));
}

// --- Toggle login status (logout) ---
function toggleLoginStatus() {
  isLoggedIn = !isLoggedIn;
  document.getElementById('login-btn').textContent = isLoggedIn ? 'Logout' : 'Login';
  if (!isLoggedIn) {
    alert("You are logged out!");
    // after logout user must login again to add/buy (state is not persisted)
  }
}

// --- Bootstrapping ---
document.addEventListener('DOMContentLoaded', loadProductData);


    </script>
</body>
</html>
